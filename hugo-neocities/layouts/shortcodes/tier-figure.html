<!--
Adapted from https://github.com/liwenyip/hugo-easy-gallery/blob/master/layouts/shortcodes/figure.html
-->
<!-- count how many times we've called this shortcode; load the css if it's the first time -->
{{- if not ($.Page.Store.Get "figurecount") }}
<link rel="stylesheet" href={{ "css/hugo-easy-gallery.css" | relURL }} />{{ end }}
{{- $.Page.Store.Add "figurecount" 1 -}}
<!-- use either src or link-thumb for thumbnail image -->
{{- $thumb := .Get "src" | default (printf "%s." (.Get "thumb") | replace (.Get "link") ".") }}

<div class="box{{ with .Get " caption-position" }} fancy-figure caption-position-{{.}}{{end}}{{ with
  .Get "caption-effect" }} caption-effect-{{.}}{{end}}" {{ with .Get "width" }}style="max-width:{{.}}" {{end}}>
  {{ if len (strings.TrimSpace .Inner) }}

  <details>
    <summary>
      <figure {{ with .Get "class" }}class="{{.}}" {{ end }} itemprop="associatedMedia" itemscope
        itemtype="http://schema.org/ImageObject" aria-label="{{ .Get "caption" }}" title="{{ .Get "caption" }}">
        <div class="img" {{ if .Parent }} style="background-image: url('{{ $thumb | relURL }}');" {{ end }}{{ with
          .Get "size" }} data-size="{{.}}" {{ end }}>
          <img itemprop="thumbnail" src="{{ $thumb | relURL }}" {{ with .Get "alt" | default (.Get "caption" )
            }}alt="{{.}}" {{ end }} {{ with .Get "height" }}style="max-height:{{.}}"
            {{end}} /><!-- <img> hidden if in .gallery -->
        </div>
        <figcaption>Review</figcaption>
      </figure>
    </summary>

    <span class="tier-side-panel">
      {{ .InnerDeindent | .Page.RenderString }}
    </span>
  </details>

  {{ else }}

  <figure {{ with .Get "class" }}class="{{.}}" {{ end }} itemprop="associatedMedia" itemscope
    itemtype="http://schema.org/ImageObject" aria-label="{{ .Get "caption" }}" title="{{ .Get "caption" }}">
    <div class="img" {{ if .Parent }} style="background-image: url('{{ $thumb | relURL }}');" {{ end }}{{ with
      .Get "size" }} data-size="{{.}}" {{ end }}>
      <img itemprop="thumbnail" src="{{ $thumb | relURL }}" {{ with .Get "alt" | default (.Get "caption" ) }}alt="{{.}}"
        {{ end }} {{ with .Get "height" }}style="max-height:{{.}}" {{end}} /><!-- <img> hidden if in .gallery -->
    </div>
    {{- if or (or (.Get "title") (.Get "caption")) (.Get "attr")}}
    <figcaption>
      <a href="{{ .Get "link" }}"><i class="fa fa-external-link" aria-hidden="true"></i></a>
    </figcaption>
    {{- end }}
  </figure>

  {{ end }}
</div>